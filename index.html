<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>de vraag van vandaag</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:#f8fafc;
      --muted:#94a3b8;
      --accent:#5eead4;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;
      background:radial-gradient(1200px 600px at 50% 5%, #1f2a44, var(--bg));
    }

    /* meer ruimte bovenaan, zodat de titel lager staat */
    .wrap{
      max-width:1200px;margin:0 auto;
      padding:clamp(28px,6vh,90px) 1rem 3rem;
      display:grid;gap:clamp(12px,1.8vh,20px);
      min-height:100%;
      grid-template-rows:auto 1fr auto;
    }

    /* header, links fullscreen, midden titel, rechts geluid */
    header.header{
      display:grid;grid-template-columns:1fr auto 1fr;
      align-items:center;gap:.75rem;
    }
    header .left{display:flex;gap:.5rem;justify-content:flex-start}
    header .right{display:flex;gap:.5rem;justify-content:flex-end}
    header h1{
      margin:0;font-weight:900;letter-spacing:.2px;
      font-size:clamp(1.8rem,2.4vw + 1rem,3rem);
      text-align:center;
    }
    .topbtn{
      background:rgba(148,163,184,.12);
      border:1px solid rgba(148,163,184,.25);
      color:white;padding:.6rem .9rem;border-radius:.75rem;
      cursor:pointer;font-weight:700;
    }

    .stage{display:grid;place-items:center}

    /* veel groter venster, schaal responsief op hoogte en breedte */
    .reel{
      position:relative;
      width:clamp(380px,56vmin,860px);
      aspect-ratio:1 / 1;
      overflow:hidden;
    }

    /* wit paneel achter de rol, gelijk aan maskermaat */
    .panel{
      position:absolute;inset:0;background:#fff;
      transform:scale(.92);transform-origin:center;
      border-radius:1rem;z-index:1;
      box-shadow:0 24px 70px rgba(0,0,0,.28);
    }

    .window{
      position:absolute;inset:9% 9%;
      display:grid;place-items:center;overflow:hidden;
      background:#000;border-radius:1rem;z-index:2;
    }
    .strip{
      position:absolute;left:0;right:0;top:0;
      display:flex;flex-direction:column;align-items:stretch;
      gap:0;padding:0;will-change:transform;
    }
    .symbol{display:block;height:100%;width:100%;object-fit:contain}

    .maskimg{
      position:absolute;inset:0;width:100%;height:100%;
      object-fit:cover;transform:scale(.92);transform-origin:center;
      pointer-events:none;z-index:3;
    }

    /* vraag nog iets lager in beeld */
    .message-wrap{
      position:absolute;inset:0;
      display:flex;align-items:flex-end;justify-content:center;
      padding-bottom:2.4%;z-index:4;pointer-events:none;
    }
    .message{
      max-width:92%;text-align:center;line-height:1.25;font-weight:800;
      font-size:clamp(1.1rem,1.1vw + 1.1rem,2rem);
      opacity:0;transform:translateY(8px) scale(.98);
      filter:drop-shadow(0 8px 20px rgba(0,0,0,.55));
    }
    .message.show{
      animation:reveal 900ms cubic-bezier(.2,.9,.2,1) forwards,
                sparkle 2.8s ease-in-out infinite;
    }
    @keyframes reveal{
      0%{opacity:0;transform:translateY(8px) scale(.98)}
      60%{opacity:1;transform:translateY(0) scale(1.01)}
      100%{opacity:1;transform:translateY(0) scale(1)}
    }
    @keyframes sparkle{
      0%,100%{text-shadow:0 0 0 rgba(94,234,212,0)}
      50%{text-shadow:0 0 18px rgba(94,234,212,.45)}
    }
    .message .chip{
      display:inline-block;margin-bottom:.5rem;padding:.25rem .55rem;
      border-radius:999px;font-size:.95rem;font-weight:900;letter-spacing:.4px;
      color:#062a27;background:var(--accent);
    }

    /* startknop hoger, dichter bij het venster, tip eronder */
    .controls{
      margin-top:clamp(10px,1.6vh,16px);
      display:grid;place-items:center;gap:.4rem;
    }
    .btn{
      padding:1.05rem 1.4rem;border:0;border-radius:1rem;
      background:linear-gradient(180deg,#10b981,#059669);
      color:#fff;font-weight:800;
      font-size:clamp(1.05rem,1.1vw + .7rem,1.5rem);
      cursor:pointer;box-shadow:0 14px 34px rgba(16,185,129,.35);
      transform:scale(1);transition:transform .08s ease;
    }
    .btn.shrink{transform:scale(.92)}
    .hint{font-size:.95rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="left">
        <button id="fsBtn" class="topbtn">Volledig scherm</button>
      </div>
      <h1>de vraag van vandaag</h1>
      <div class="right">
        <button id="muteBtn" class="topbtn">Geluid aan</button>
      </div>
    </header>

    <section class="stage">
      <div class="reel">
        <div class="panel" aria-hidden="true"></div>
        <div class="window" id="win">
          <div class="strip" id="strip"></div>
          <div class="message-wrap" aria-live="polite">
            <div id="message" class="message"></div>
          </div>
        </div>
        <img class="maskimg" src="masker 900x900.png" alt="masker" />
      </div>
    </section>

    <section class="controls">
      <button class="btn" id="spinBtn">Start</button>
      <div class="hint">Tip, gebruik de spatiebalk</div>
    </section>
  </div>

  <script>
    // afbeeldingen
    const IMAGES = [
      { name: "help", src: "help.gif" },
      { name: "foutje voor foutjesmuur", src: "foutje voor foutjesmuur.gif" },
      { name: "trots", src: "trots.gif" },
      { name: "vertellen", src: "vertellen.gif" },
      { name: "moeilijker maken", src: "moeilijker maken.gif" },
      { name: "veranderen", src: "veranderen.gif" },
      { name: "denken", src: "denken.gif" }
    ];

    const MESSAGES = {
      "help": "Help een ander. Geef een tip aan iemand die hetzelfde werkje wil doen.",
      "foutje voor foutjesmuur": "Heb je per ongeluk een foutje gemaakt 👍, wat deed je toen",
      "trots": "Waar ben je trots op",
      "vertellen": "Wat zou je een ander kind over jouw werkje willen vertellen",
      "moeilijker maken": "Hoe kun je jouw werkje moeilijker maken",
      "veranderen": "Wat zou je aan het werkje willen veranderen",
      "denken": "Wat heb je bij dit werkje geoefend"
    };

    const win = document.getElementById('win');
    const strip = document.getElementById('strip');
    const msgEl = document.getElementById('message');
    const spinBtn = document.getElementById('spinBtn');
    const fsBtn = document.getElementById('fsBtn');
    const muteBtn = document.getElementById('muteBtn');

    // tikt op constant tempo
    let audioCtx = null;
    let tickInterval = null;
    let muted = false;
    function ensureAudio(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === 'suspended') audioCtx.resume();
    }
    function tickOnce(){
      if(muted) return;
      ensureAudio();
      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'square';
      osc.frequency.setValueAtTime(900, t);
      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(0.16, t + 0.006);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.05);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(t); osc.stop(t + 0.06);
    }
    function startTicks(){ stopTicks(); tickInterval = setInterval(tickOnce, 85); }
    function stopTicks(){ if(tickInterval){ clearInterval(tickInterval); tickInterval = null; } }

    // preload
    IMAGES.forEach(it => { const img = new Image(); img.src = it.src; });

    let spinning = false;
    let prevTarget = -1;

    function buildOrder(target){
      const cyclesBefore = 14, cyclesAfter = 14;
      const order = [];
      const offset = Math.floor(Math.random() * IMAGES.length);
      for(let r=0;r<cyclesBefore;r++) for(let i=0;i<IMAGES.length;i++) order.push((i+offset)%IMAGES.length);
      order.push(target, target, target);
      for(let r=0;r<cyclesAfter;r++) for(let i=0;i<IMAGES.length;i++) order.push((i+offset)%IMAGES.length);
      return { order, stopIndex: cyclesBefore*IMAGES.length + 1 };
    }

    function populateStrip(order){
      strip.innerHTML = "";
      order.forEach(idx => {
        const img = document.createElement('img');
        img.className = 'symbol';
        img.src = IMAGES[idx].src;
        img.alt = IMAGES[idx].name;
        strip.appendChild(img);
      });
    }

    function animateTo(distance, duration){
      return new Promise(resolve => {
        const start = performance.now();
        function step(now){
          const t = Math.min(1, (now - start) / duration);
          const eased = 1 - Math.pow(1 - t, 3);
          strip.style.transform = `translateY(${-Math.round(eased * distance)}px)`;
          if(t < 1){ requestAnimationFrame(step); }
          else{ resolve(); }
        }
        requestAnimationFrame(step);
      });
    }

    function msgFor(name){
      const k = name.toLowerCase();
      if(MESSAGES[k]) return MESSAGES[k];
      for(const x in MESSAGES) if(k.includes(x)) return MESSAGES[x];
      return "";
    }

    async function spin(){
      if(spinning) return;
      spinning = true;
      spinBtn.classList.add('shrink');
      msgEl.classList.remove('show');
      msgEl.textContent = "";

      let target = Math.floor(Math.random() * IMAGES.length);
      if(IMAGES.length > 1 && target === prevTarget)
        target = (target + 1 + Math.floor(Math.random()*(IMAGES.length-1))) % IMAGES.length;
      prevTarget = target;

      const {order, stopIndex} = buildOrder(target);
      populateStrip(order);

      const imgs = Array.from(strip.querySelectorAll('img'));
      await Promise.all(imgs.map(img => (img.decode ? img.decode().catch(()=>{}) : Promise.resolve())));

      const windowH = Math.round(win.getBoundingClientRect().height);
      imgs.forEach(img => img.style.height = windowH + "px");

      const distance = stopIndex * windowH;

      ensureAudio();
      startTicks();
      await animateTo(distance, 1900);
      stopTicks();

      const name = IMAGES[target].name;
      const line = msgFor(name);
      if(line){
        msgEl.innerHTML = '<span class="chip">Bespreek</span><br>' + line;
        msgEl.classList.add('show');
      }
      spinBtn.classList.remove('shrink');
      spinning = false;
    }

    // interactie
    spinBtn.addEventListener('click', e => { e.preventDefault(); spin(); });
    spinBtn.addEventListener('touchstart', e => { e.preventDefault(); spin(); }, {passive:false});
    document.addEventListener('keydown', e => { if(e.code === 'Space'){ e.preventDefault(); spin(); } });

    fsBtn.addEventListener('click', async () => {
      const el = document.documentElement;
      if(!document.fullscreenElement){ await el.requestFullscreen(); fsBtn.textContent = "Scherm sluiten"; }
      else{ await document.exitFullscreen(); fsBtn.textContent = "Volledig scherm"; }
    });
    muteBtn.addEventListener('click', () => {
      muted = !muted;
      muteBtn.textContent = muted ? "Geluid uit" : "Geluid aan";
      if(!muted) ensureAudio();
    });
  </script>
</body>
</html>
